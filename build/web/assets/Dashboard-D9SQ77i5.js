import{i as O}from"./index-Bb6yjXMn.js";import{d as A,r as M,a as B,s as b,o as L,v as T,b as f,e as F,g as e,w as s,i,f as o,t as d,k as u,E as g,j as G,_ as I}from"./index-Cagw-rQE.js";const K={class:"dashboard"},q={class:"stat-value"},H={class:"stat-value"},J={class:"stat-value"},Q={class:"stat-value"},W={class:"card-header"},Y={class:"xray-controls"},Z={class:"resource-item"},tt={class:"resource-item"},at={class:"resource-item"},et=A({__name:"Dashboard",setup(st){const v=M();let _=null;const p=M(!1),m=B({totalClients:0,activeClients:0,totalUpload:0,totalDownload:0}),r=B({hostname:"",os:"",arch:"",uptime:0,xrayRunning:!1,xrayVersion:"",cpu:{usage:[]},memory:{usedPercent:0},disk:{usedPercent:0}}),U=b(()=>{var a,n;if(!((n=(a=r.cpu)==null?void 0:a.usage)!=null&&n.length))return 0;const t=r.cpu.usage.reduce((l,c)=>l+c,0)/r.cpu.usage.length;return Math.round(t)}),D=b(()=>{var t;return Math.round(((t=r.memory)==null?void 0:t.used_percent)||0)}),S=b(()=>{var t;return Math.round(((t=r.disk)==null?void 0:t.used_percent)||0)});L(async()=>{await Promise.all([$(),h(),X()])}),T(()=>{_&&(_.dispose(),_=null)});async function $(){try{const t=await f.stats.getSummary();Object.assign(m,{totalClients:t.data.total_clients,activeClients:t.data.active_clients,totalUpload:t.data.total_upload,totalDownload:t.data.total_download})}catch(t){console.error(t)}}async function h(){try{const t=await f.system.getStatus();Object.assign(r,{hostname:t.data.hostname,os:t.data.os,arch:t.data.arch,uptime:t.data.uptime,xrayRunning:t.data.xray_running,xrayVersion:t.data.xray_version,cpu:t.data.cpu,memory:t.data.memory,disk:t.data.disk})}catch(t){console.error(t)}}async function R(){p.value=!0;try{await f.system.restart(),g.success("Xray 重启成功"),await h()}catch(t){g.error(t.message||"重启失败")}finally{p.value=!1}}async function V(){p.value=!0;try{await f.system.reload(),g.success("Xray 配置重载成功"),await h()}catch(t){g.error(t.message||"重载失败")}finally{p.value=!1}}async function X(){try{const t=await f.stats.getDaily(30);k(t.data||[])}catch{k([])}}function k(t){v.value&&(_=O(v.value),_.setOption({tooltip:{trigger:"axis"},legend:{data:["上传","下载"]},xAxis:{type:"category",data:t.map(a=>a.date)},yAxis:{type:"value",axisLabel:{formatter:a=>x(a,!0)}},series:[{name:"上传",type:"line",smooth:!0,data:t.map(a=>a.upload)},{name:"下载",type:"line",smooth:!0,data:t.map(a=>a.download)}]}))}function x(t,a=!1){if(!t)return"0 B";const n=["B","KB","MB","GB","TB"],l=Math.floor(Math.log(t)/Math.log(1024)),c=(t/Math.pow(1024,l)).toFixed(2);return a?`${c}${n[l]}`:`${c} ${n[l]}`}function P(t){if(!t)return"0秒";const a=Math.floor(t/86400),n=Math.floor(t%86400/3600),l=Math.floor(t%3600/60);return`${a}天 ${n}时 ${l}分`}return(t,a)=>{const n=i("el-card"),l=i("el-col"),c=i("el-row"),j=i("el-tag"),C=i("el-button"),z=i("el-button-group"),y=i("el-descriptions-item"),E=i("el-descriptions"),N=i("el-divider"),w=i("el-progress");return G(),F("div",K,[e(c,{gutter:20,class:"stat-row"},{default:s(()=>[e(l,{span:6},{default:s(()=>[e(n,{class:"stat-card"},{default:s(()=>[o("div",q,d(m.totalClients),1),a[0]||(a[0]=o("div",{class:"stat-label"},"总用户数",-1))]),_:1})]),_:1}),e(l,{span:6},{default:s(()=>[e(n,{class:"stat-card"},{default:s(()=>[o("div",H,d(m.activeClients),1),a[1]||(a[1]=o("div",{class:"stat-label"},"活跃用户",-1))]),_:1})]),_:1}),e(l,{span:6},{default:s(()=>[e(n,{class:"stat-card"},{default:s(()=>[o("div",J,d(x(m.totalUpload)),1),a[2]||(a[2]=o("div",{class:"stat-label"},"总上传",-1))]),_:1})]),_:1}),e(l,{span:6},{default:s(()=>[e(n,{class:"stat-card"},{default:s(()=>[o("div",Q,d(x(m.totalDownload)),1),a[3]||(a[3]=o("div",{class:"stat-label"},"总下载",-1))]),_:1})]),_:1})]),_:1}),e(c,{gutter:20},{default:s(()=>[e(l,{span:12},{default:s(()=>[e(n,{class:"system-card"},{header:s(()=>[o("div",W,[a[6]||(a[6]=o("span",null,"系统状态",-1)),o("div",Y,[e(j,{type:r.xrayRunning?"success":"danger",size:"small"},{default:s(()=>[u(" Xray: "+d(r.xrayRunning?"运行中":"已停止"),1)]),_:1},8,["type"]),e(z,{size:"small",style:{"margin-left":"10px"}},{default:s(()=>[e(C,{onClick:R,loading:p.value},{default:s(()=>[...a[4]||(a[4]=[u("重启",-1)])]),_:1},8,["loading"]),e(C,{onClick:V,loading:p.value},{default:s(()=>[...a[5]||(a[5]=[u("重载",-1)])]),_:1},8,["loading"])]),_:1})])])]),default:s(()=>[e(E,{column:2,size:"small"},{default:s(()=>[e(y,{label:"主机名"},{default:s(()=>[u(d(r.hostname),1)]),_:1}),e(y,{label:"系统"},{default:s(()=>[u(d(r.os)+"/"+d(r.arch),1)]),_:1}),e(y,{label:"运行时间"},{default:s(()=>[u(d(P(r.uptime)),1)]),_:1}),e(y,{label:"Xray版本"},{default:s(()=>[u(d(r.xrayVersion),1)]),_:1})]),_:1}),e(N),o("div",Z,[a[7]||(a[7]=o("span",null,"CPU 使用率",-1)),e(w,{percentage:U.value,"stroke-width":8},null,8,["percentage"])]),o("div",tt,[a[8]||(a[8]=o("span",null,"内存使用率",-1)),e(w,{percentage:D.value,"stroke-width":8},null,8,["percentage"])]),o("div",at,[a[9]||(a[9]=o("span",null,"磁盘使用率",-1)),e(w,{percentage:S.value,"stroke-width":8},null,8,["percentage"])])]),_:1})]),_:1}),e(l,{span:12},{default:s(()=>[e(n,{class:"chart-card"},{header:s(()=>[...a[10]||(a[10]=[o("span",null,"流量趋势（近30天）",-1)])]),default:s(()=>[o("div",{ref_key:"chartRef",ref:v,class:"chart"},null,512)]),_:1})]),_:1})]),_:1})])}}}),lt=I(et,[["__scopeId","data-v-011b9e01"]]);export{lt as default};

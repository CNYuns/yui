import{d as W,u as X,r as D,a as Z,o as h,e as ee,g as e,w as t,i as n,f as s,l as m,m as oe,n as c,p as b,t as U,k as w,T as te,c as ne,b as se,E as L,j as f,q as le,_ as ae}from"./index-Cagw-rQE.js";const de={class:"layout"},re={class:"header-left"},ue={class:"page-title"},ie={class:"header-right"},me={class:"user-info"},_e={class:"username"},pe=W({__name:"Layout",setup(fe){const x=oe(),A=ne(),r=X(),_=D(!1),g=D(),a=Z({oldPassword:"",newPassword:"",confirmPassword:""}),R={oldPassword:[{required:!0,message:"请输入原密码",trigger:"blur"}],newPassword:[{required:!0,message:"请输入新密码",trigger:"blur"},{min:6,message:"密码长度不能少于6位",trigger:"blur"}],confirmPassword:[{required:!0,message:"请确认新密码",trigger:"blur"},{validator:(p,o,u)=>{o!==a.newPassword?u(new Error("两次输入的密码不一致")):u()},trigger:"blur"}]};h(()=>{r.fetchProfile()});function S(p){p==="logout"?(r.logout(),A.push("/login")):p==="password"&&(_.value=!0)}async function q(){var o,u;if(await((o=g.value)==null?void 0:o.validate().catch(()=>!1)))try{await se.auth.changePassword(a.oldPassword,a.newPassword),L.success("密码修改成功"),_.value=!1,(u=g.value)==null||u.resetFields()}catch(d){L.error(d.message||"修改失败")}}return(p,o)=>{const u=n("Odometer"),d=n("el-icon"),i=n("el-menu-item"),B=n("Connection"),E=n("User"),F=n("DataLine"),N=n("Document"),T=n("Setting"),I=n("List"),M=n("el-menu"),O=n("el-aside"),j=n("el-avatar"),z=n("ArrowDown"),V=n("el-dropdown-item"),Y=n("el-dropdown-menu"),$=n("el-dropdown"),G=n("el-header"),H=n("router-view"),J=n("el-main"),y=n("el-container"),v=n("el-input"),P=n("el-form-item"),K=n("el-form"),C=n("el-button"),Q=n("el-dialog");return f(),ee("div",de,[e(y,null,{default:t(()=>[e(O,{width:"220px",class:"sidebar"},{default:t(()=>[o[12]||(o[12]=s("div",{class:"logo"},[s("h1",null,"Y-UI")],-1)),e(M,{"default-active":m(x).path,router:"","background-color":"#304156","text-color":"#bfcbd9","active-text-color":"#409eff"},{default:t(()=>[e(i,{index:"/dashboard"},{default:t(()=>[e(d,null,{default:t(()=>[e(u)]),_:1}),o[5]||(o[5]=s("span",null,"仪表盘",-1))]),_:1}),e(i,{index:"/inbounds"},{default:t(()=>[e(d,null,{default:t(()=>[e(B)]),_:1}),o[6]||(o[6]=s("span",null,"入站管理",-1))]),_:1}),e(i,{index:"/clients"},{default:t(()=>[e(d,null,{default:t(()=>[e(E)]),_:1}),o[7]||(o[7]=s("span",null,"用户管理",-1))]),_:1}),e(i,{index:"/traffic"},{default:t(()=>[e(d,null,{default:t(()=>[e(F)]),_:1}),o[8]||(o[8]=s("span",null,"流量统计",-1))]),_:1}),m(r).isAdmin?(f(),c(i,{key:0,index:"/certificates"},{default:t(()=>[e(d,null,{default:t(()=>[e(N)]),_:1}),o[9]||(o[9]=s("span",null,"证书管理",-1))]),_:1})):b("",!0),m(r).isAdmin?(f(),c(i,{key:1,index:"/settings"},{default:t(()=>[e(d,null,{default:t(()=>[e(T)]),_:1}),o[10]||(o[10]=s("span",null,"系统设置",-1))]),_:1})):b("",!0),m(r).isAdmin?(f(),c(i,{key:2,index:"/audit"},{default:t(()=>[e(d,null,{default:t(()=>[e(I)]),_:1}),o[11]||(o[11]=s("span",null,"审计日志",-1))]),_:1})):b("",!0)]),_:1},8,["default-active"])]),_:1}),e(y,null,{default:t(()=>[e(G,{class:"header"},{default:t(()=>[s("div",re,[s("span",ue,U(m(x).meta.title),1)]),s("div",ie,[e($,{onCommand:S},{dropdown:t(()=>[e(Y,null,{default:t(()=>[e(V,{command:"password"},{default:t(()=>[...o[13]||(o[13]=[w("修改密码",-1)])]),_:1}),e(V,{command:"logout",divided:""},{default:t(()=>[...o[14]||(o[14]=[w("退出登录",-1)])]),_:1})]),_:1})]),default:t(()=>{var l,k;return[s("span",me,[e(j,{size:32,icon:"User"}),s("span",_e,U(((l=m(r).user)==null?void 0:l.nickname)||((k=m(r).user)==null?void 0:k.email)),1),e(d,null,{default:t(()=>[e(z)]),_:1})])]}),_:1})])]),_:1}),e(J,{class:"main"},{default:t(()=>[e(H,null,{default:t(({Component:l})=>[e(te,{name:"fade",mode:"out-in"},{default:t(()=>[(f(),c(le(l)))]),_:2},1024)]),_:1})]),_:1})]),_:1})]),_:1}),e(Q,{modelValue:_.value,"onUpdate:modelValue":o[4]||(o[4]=l=>_.value=l),title:"修改密码",width:"400px"},{footer:t(()=>[e(C,{onClick:o[3]||(o[3]=l=>_.value=!1)},{default:t(()=>[...o[15]||(o[15]=[w("取消",-1)])]),_:1}),e(C,{type:"primary",onClick:q},{default:t(()=>[...o[16]||(o[16]=[w("确定",-1)])]),_:1})]),default:t(()=>[e(K,{ref_key:"passwordFormRef",ref:g,model:a,rules:R,"label-width":"80px"},{default:t(()=>[e(P,{label:"原密码",prop:"oldPassword"},{default:t(()=>[e(v,{modelValue:a.oldPassword,"onUpdate:modelValue":o[0]||(o[0]=l=>a.oldPassword=l),type:"password","show-password":""},null,8,["modelValue"])]),_:1}),e(P,{label:"新密码",prop:"newPassword"},{default:t(()=>[e(v,{modelValue:a.newPassword,"onUpdate:modelValue":o[1]||(o[1]=l=>a.newPassword=l),type:"password","show-password":""},null,8,["modelValue"])]),_:1}),e(P,{label:"确认密码",prop:"confirmPassword"},{default:t(()=>[e(v,{modelValue:a.confirmPassword,"onUpdate:modelValue":o[2]||(o[2]=l=>a.confirmPassword=l),type:"password","show-password":""},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}}),we=ae(pe,[["__scopeId","data-v-9d8e2571"]]);export{we as default};

import{d as K,r as f,a as k,o as O,b as g,e as Q,f as z,g as t,w as l,i as o,k as d,x as W,y as X,n as Y,t as D,E as u,A as h,j as S,_ as Z}from"./index-Cagw-rQE.js";const ee={class:"page-container"},te={class:"page-header"},ae=K({__name:"Certificates",setup(le){const v=f(!1),b=f(!1),p=f(!1),y=f(),C=f([]),s=k({page:1,pageSize:20,total:0}),i=k({domain:"",email:""}),U={domain:[{required:!0,message:"请输入域名",trigger:"blur"}],email:[{required:!0,message:"请输入邮箱",trigger:"blur"},{type:"email",message:"请输入有效的邮箱地址",trigger:"blur"}]};O(()=>{m()});async function m(){v.value=!0;try{const n=await g.certificates.list(s.page,s.pageSize);C.value=n.data.list,s.total=n.data.total}finally{v.value=!1}}function B(){i.domain="",i.email="",p.value=!0}async function R(){var e;if(await((e=y.value)==null?void 0:e.validate().catch(()=>!1))){b.value=!0;try{await g.certificates.request(i.domain,i.email),u.success("证书申请成功"),p.value=!1,m()}catch(w){u.error(w.message)}finally{b.value=!1}}}async function $(n){await h.confirm("确定要续签该证书吗？","提示");try{await g.certificates.renew(n.id),u.success("续签成功"),m()}catch(e){u.error(e.message)}}async function E(n){await h.confirm("确定要删除该证书吗？","提示",{type:"warning"});try{await g.certificates.delete(n.id),u.success("删除成功"),m()}catch(e){u.error(e.message)}}async function N(n){try{await g.certificates.updateAutoRenew(n.id,n.auto_renew),u.success("设置已更新")}catch(e){n.auto_renew=!n.auto_renew,u.error(e.message)}}function q(n){return{active:"success",pending:"warning",expired:"danger",error:"danger"}[n]||"info"}function A(n){return new Date(n).toLocaleDateString("zh-CN")}return(n,e)=>{const w=o("Plus"),M=o("el-icon"),c=o("el-button"),r=o("el-table-column"),P=o("el-tag"),I=o("el-switch"),T=o("el-table"),j=o("el-pagination"),L=o("el-card"),F=o("el-alert"),V=o("el-input"),x=o("el-form-item"),G=o("el-form"),H=o("el-dialog"),J=X("loading");return S(),Q("div",ee,[z("div",te,[e[8]||(e[8]=z("h2",null,"证书管理",-1)),t(c,{type:"primary",onClick:e[0]||(e[0]=a=>B())},{default:l(()=>[t(M,null,{default:l(()=>[t(w)]),_:1}),e[7]||(e[7]=d(" 申请证书 ",-1))]),_:1})]),t(L,null,{default:l(()=>[W((S(),Y(T,{data:C.value},{default:l(()=>[t(r,{prop:"id",label:"ID",width:"60"}),t(r,{prop:"domain",label:"域名",width:"200"}),t(r,{prop:"email",label:"邮箱",width:"180"}),t(r,{prop:"provider",label:"提供商",width:"120"}),t(r,{prop:"expire_at",label:"到期时间",width:"120"},{default:l(({row:a})=>[d(D(A(a.expire_at)),1)]),_:1}),t(r,{prop:"status",label:"状态",width:"100"},{default:l(({row:a})=>[t(P,{type:q(a.status)},{default:l(()=>[d(D(a.status),1)]),_:2},1032,["type"])]),_:1}),t(r,{prop:"auto_renew",label:"自动续签",width:"100"},{default:l(({row:a})=>[t(I,{modelValue:a.auto_renew,"onUpdate:modelValue":_=>a.auto_renew=_,onChange:_=>N(a)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),t(r,{label:"操作",width:"200",fixed:"right"},{default:l(({row:a})=>[t(c,{size:"small",onClick:_=>$(a),disabled:a.status==="pending"},{default:l(()=>[...e[9]||(e[9]=[d(" 续签 ",-1)])]),_:1},8,["onClick","disabled"]),t(c,{size:"small",type:"danger",onClick:_=>E(a)},{default:l(()=>[...e[10]||(e[10]=[d("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[J,v.value]]),t(j,{class:"pagination","current-page":s.page,"onUpdate:currentPage":e[1]||(e[1]=a=>s.page=a),"page-size":s.pageSize,"onUpdate:pageSize":e[2]||(e[2]=a=>s.pageSize=a),total:s.total,layout:"total, prev, pager, next",onCurrentChange:m},null,8,["current-page","page-size","total"])]),_:1}),t(H,{modelValue:p.value,"onUpdate:modelValue":e[6]||(e[6]=a=>p.value=a),title:"申请证书",width:"500px"},{footer:l(()=>[t(c,{onClick:e[5]||(e[5]=a=>p.value=!1)},{default:l(()=>[...e[12]||(e[12]=[d("取消",-1)])]),_:1}),t(c,{type:"primary",onClick:R,loading:b.value},{default:l(()=>[...e[13]||(e[13]=[d("申请",-1)])]),_:1},8,["loading"])]),default:l(()=>[t(F,{type:"info",closable:!1,style:{"margin-bottom":"20px"}},{default:l(()=>[...e[11]||(e[11]=[d(" 请确保域名已正确解析到当前服务器，且80端口可访问。 ",-1)])]),_:1}),t(G,{ref_key:"formRef",ref:y,model:i,rules:U,"label-width":"80px"},{default:l(()=>[t(x,{label:"域名",prop:"domain"},{default:l(()=>[t(V,{modelValue:i.domain,"onUpdate:modelValue":e[3]||(e[3]=a=>i.domain=a),placeholder:"example.com"},null,8,["modelValue"])]),_:1}),t(x,{label:"邮箱",prop:"email"},{default:l(()=>[t(V,{modelValue:i.email,"onUpdate:modelValue":e[4]||(e[4]=a=>i.email=a),placeholder:"用于接收证书到期提醒"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}}),oe=Z(ae,[["__scopeId","data-v-ddfdea02"]]);export{oe as default};
